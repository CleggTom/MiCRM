<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Basic Usage · MiCRM.jl</title><script data-outdated-warner src="../../../assets/warner.js"></script><link rel="canonical" href="https://cleggtom.github.io/MiCRM.jl/pages/manual/guide/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><script src="../../../../copy.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.png" alt="MiCRM.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">MiCRM.jl</a></span></div><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li class="is-active"><a class="tocitem" href>Basic Usage</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#Method-1:-Numerical-Integration-Only"><span>Method 1: Numerical Integration Only</span></a></li><li><a class="tocitem" href="#Method-2:-Symbolic-representation-and-ModelingToolKit"><span>Method 2: Symbolic representation and <code>ModelingToolKit</code></span></a></li></ul></li><li><a class="tocitem" href="../examples/">Examples</a></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../../library/public/">Public</a></li><li><a class="tocitem" href="../../library/internal/">Internal</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Basic Usage</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Basic Usage</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/cleggtom/MiCRM.jl/blob/master/docs/src/pages/manual/guide.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Basic-Usage"><a class="docs-heading-anchor" href="#Basic-Usage">Basic Usage</a><a id="Basic-Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-Usage" title="Permalink"></a></h1><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>This page will guide you through generating and simulating the MiCRM model as described by the set of equations:</p><p class="math-container">\[\begin{aligned}
    \frac{dx_i}{dt} &amp;= \sum_{j = 0}^{M} x_i y_{j} u_{ij}  (1 - \sum_{k = 0}^{M} l_{j,k}) - x_i R_i \\
    \frac{dy_j}{dt} &amp;= \rho_j - y_j \omega_j - \sum_{i = 0}^{N} x_i y_{j} u_{ij} + \sum_{i = 0}^{N} \sum_{k = 0}^{M} x_i y_{k} u_{ik} l_{kj}
\end{aligned}\]</p><p>The <code>MiCRM</code> package provides two ways to simulate the MiCRM system depending on your requirements:</p><ol><li>Directly using the <code>DifferentialEquations</code> package with the <code>ODEProblem</code> function.</li><li>Using the symbolic reperesntation provided by <code>ModelingToolKit</code> which allows symbolic manipualtion of the system in addition to numerical integration. </li></ol><p>In general we recomend using the second method with the <code>MTK</code> which allows for greater flexibility and is significantly faster for simulations due to the automaticly generated derivative functions and jacobian matrix. This method does however incur a significant intial computational cost whist contstructing the symbollic representation so for cases where you want to play around with system size it may be faster to use the first direct numberical intergration method. </p><h2 id="Method-1:-Numerical-Integration-Only"><a class="docs-heading-anchor" href="#Method-1:-Numerical-Integration-Only">Method 1: Numerical Integration Only</a><a id="Method-1:-Numerical-Integration-Only-1"></a><a class="docs-heading-anchor-permalink" href="#Method-1:-Numerical-Integration-Only" title="Permalink"></a></h2><h2 id="Method-2:-Symbolic-representation-and-ModelingToolKit"><a class="docs-heading-anchor" href="#Method-2:-Symbolic-representation-and-ModelingToolKit">Method 2: Symbolic representation and <code>ModelingToolKit</code></a><a id="Method-2:-Symbolic-representation-and-ModelingToolKit-1"></a><a class="docs-heading-anchor-permalink" href="#Method-2:-Symbolic-representation-and-ModelingToolKit" title="Permalink"></a></h2><p>This method requires 4 steps  is divided into x steps:</p><ol><li>Set parameters</li><li>Generate <code>ODESystem</code></li><li>Convert to <code>ODEProblem</code></li><li>Simulate system</li></ol><h3 id="Setting-Parameters"><a class="docs-heading-anchor" href="#Setting-Parameters">Setting Parameters</a><a id="Setting-Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-Parameters" title="Permalink"></a></h3><p>First we must generate a dictionary with values for the parameters of the MiCRM model. The MiCRM is described by the set of equations above which have the following set of parameters:</p><table><tr><th style="text-align: right">Parameter</th><th style="text-align: right">Description</th><th style="text-align: right">Key</th><th style="text-align: right">Type</th><th style="text-align: right">Required?</th></tr><tr><td style="text-align: right"><span>$x_i$</span></td><td style="text-align: right">Biomass of the <span>$i$</span>th consumer</td><td style="text-align: right">-</td><td style="text-align: right"><code>Float64</code></td><td style="text-align: right">✖</td></tr><tr><td style="text-align: right"><span>$y_j$</span></td><td style="text-align: right">Mass of the <span>$j$</span>th resource</td><td style="text-align: right">-</td><td style="text-align: right"><code>Float64</code></td><td style="text-align: right">✖</td></tr><tr><td style="text-align: right"><span>$N$</span></td><td style="text-align: right">Number of consumer populations</td><td style="text-align: right"><code>:N</code></td><td style="text-align: right"><code>Int64</code></td><td style="text-align: right">✔</td></tr><tr><td style="text-align: right"><span>$M$</span></td><td style="text-align: right">Number of resources</td><td style="text-align: right"><code>:M</code></td><td style="text-align: right"><code>Int64</code></td><td style="text-align: right">✔</td></tr><tr><td style="text-align: right"><span>$u_{ij}$</span></td><td style="text-align: right">Uptake rate of the <code>j</code>th resource  by the <code>i</code>th consumer</td><td style="text-align: right"><code>:u</code></td><td style="text-align: right"><code>Matrix{Float64}</code></td><td style="text-align: right">✔</td></tr><tr><td style="text-align: right"><span>$R_i$</span></td><td style="text-align: right">Loss term for the <span>$i$</span>th consumer</td><td style="text-align: right"><code>:R</code></td><td style="text-align: right"><code>Vector{Float64}</code></td><td style="text-align: right">✔</td></tr><tr><td style="text-align: right"><span>$\rho_j$</span></td><td style="text-align: right">Inflow rate for the <span>$j$</span>th resource</td><td style="text-align: right"><code>:ρ</code></td><td style="text-align: right"><code>Vector{Float64}</code></td><td style="text-align: right">✔</td></tr><tr><td style="text-align: right"><span>$\omega_j$</span></td><td style="text-align: right">Outflow term for the <span>$j$</span>resource</td><td style="text-align: right"><code>:ω</code></td><td style="text-align: right"><code>Vector{Float64}</code></td><td style="text-align: right">✔</td></tr><tr><td style="text-align: right"><span>$l_{jk}$</span></td><td style="text-align: right">Proportion of uptake of the <span>$j$</span>th resource leaked to the <span>$k$</span>th resource.</td><td style="text-align: right"><code>:l</code></td><td style="text-align: right"><code>Matrix{Float64}</code></td><td style="text-align: right">✔</td></tr></table><p>The parameter dictionary must have the entries indicated above with the relevant key-value pairs. To aid in the construction of these parameter the package comes with several functions to randomly generate these parameter dictionaries with different communtiy structures (see #generating communities). </p><p>In this example we will choose the simplest communtiy generation function <code>random_community</code> which generates communities with uniform random uptake and leakage matricies. </p><pre><code class="language-julia hljs">N,M = 2,2 #set system size
params = random_micrm_params(N,M, 0.3) #leakage = 0.3</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{Symbol, Any} with 7 entries:
  :l =&gt; [0.0828063 0.217194; 0.295464 0.00453609]
  :ρ =&gt; [0.77018, 0.780519]
  :N =&gt; 2
  :M =&gt; 2
  :R =&gt; [0.914929, 0.192808]
  :ω =&gt; [0.670264, 0.167712]
  :u =&gt; [0.0420698 0.95793; 0.194952 0.805048]</code></pre><h3 id="Generating-the-ODESystem"><a class="docs-heading-anchor" href="#Generating-the-ODESystem">Generating the <code>ODESystem</code></a><a id="Generating-the-ODESystem-1"></a><a class="docs-heading-anchor-permalink" href="#Generating-the-ODESystem" title="Permalink"></a></h3><p>Once we have our parameter dictionary we next generate an <code>ODESystem</code> object using the provided <code>micrm_system</code> function. This function takes the parameter dictionary provided, creates a symbolic representation of the MiCRM system and then wraps it in an <code>ODESystem</code> object. The <code>ODESystem</code> object is from the package <code>ModelingToolKit</code> and provides a symbolic represntation of the system as well as many helper functions to extract and calculate properties of interest such as the Jacobian. The function also optionally takes a threshold biomass extinction value <code>δ</code> below which consumer populations are considered extinct during the numerical simulations.  </p><pre><code class="language-julia hljs">@named sys = micrm_system(params)</code></pre><p>\begin{align} \frac{dx<em>1(t)}{dt} =&amp;  - R</em>1 \mathrm{x<em>1}\left( t \right) + u</em>{1}ˏ<em>1 \mathrm{x</em>1}\left( t \right) \mathrm{y<em>1}\left( t \right) + u</em>{1}ˏ<em>2 \mathrm{x</em>1}\left( t \right) \mathrm{y<em>2}\left( t \right) - l</em>{1}ˏ<em>1 u</em>{1}ˏ<em>1 \mathrm{x</em>1}\left( t \right) \mathrm{y<em>1}\left( t \right) - l</em>{1}ˏ<em>2 u</em>{1}ˏ<em>1 \mathrm{x</em>1}\left( t \right) \mathrm{y<em>1}\left( t \right) - l</em>{2}ˏ<em>1 u</em>{1}ˏ<em>2 \mathrm{x</em>1}\left( t \right) \mathrm{y<em>2}\left( t \right) - l</em>{2}ˏ<em>2 u</em>{1}ˏ<em>2 \mathrm{x</em>1}\left( t \right) \mathrm{y<em>2}\left( t \right) \
\frac{dx</em>2(t)}{dt} =&amp;  - R<em>2 \mathrm{x</em>2}\left( t \right) + u<em>{2}ˏ</em>1 \mathrm{x<em>2}\left( t \right) \mathrm{y</em>1}\left( t \right) + u<em>{2}ˏ</em>2 \mathrm{x<em>2}\left( t \right) \mathrm{y</em>2}\left( t \right) - l<em>{1}ˏ</em>1 u<em>{2}ˏ</em>1 \mathrm{x<em>2}\left( t \right) \mathrm{y</em>1}\left( t \right) - l<em>{1}ˏ</em>2 u<em>{2}ˏ</em>1 \mathrm{x<em>2}\left( t \right) \mathrm{y</em>1}\left( t \right) - l<em>{2}ˏ</em>1 u<em>{2}ˏ</em>2 \mathrm{x<em>2}\left( t \right) \mathrm{y</em>2}\left( t \right) - l<em>{2}ˏ</em>2 u<em>{2}ˏ</em>2 \mathrm{x<em>2}\left( t \right) \mathrm{y</em>2}\left( t \right) \
\frac{dy<em>1(t)}{dt} =&amp; \rho</em>1 - \omega<em>1 \mathrm{y</em>1}\left( t \right) - u<em>{1}ˏ</em>1 \mathrm{x<em>1}\left( t \right) \mathrm{y</em>1}\left( t \right) - u<em>{2}ˏ</em>1 \mathrm{x<em>2}\left( t \right) \mathrm{y</em>1}\left( t \right) + l<em>{1}ˏ</em>1 u<em>{1}ˏ</em>1 \mathrm{x<em>1}\left( t \right) \mathrm{y</em>1}\left( t \right) + l<em>{1}ˏ</em>1 u<em>{2}ˏ</em>1 \mathrm{x<em>2}\left( t \right) \mathrm{y</em>1}\left( t \right) + l<em>{2}ˏ</em>1 u<em>{1}ˏ</em>2 \mathrm{x<em>1}\left( t \right) \mathrm{y</em>2}\left( t \right) + l<em>{2}ˏ</em>1 u<em>{2}ˏ</em>2 \mathrm{x<em>2}\left( t \right) \mathrm{y</em>2}\left( t \right) \
\frac{dy<em>2(t)}{dt} =&amp; \rho</em>2 - \omega<em>2 \mathrm{y</em>2}\left( t \right) + l<em>{1}ˏ</em>2 u<em>{1}ˏ</em>1 \mathrm{x<em>1}\left( t \right) \mathrm{y</em>1}\left( t \right) + l<em>{1}ˏ</em>2 u<em>{2}ˏ</em>1 \mathrm{x<em>2}\left( t \right) \mathrm{y</em>1}\left( t \right) - u<em>{1}ˏ</em>2 \mathrm{x<em>1}\left( t \right) \mathrm{y</em>2}\left( t \right) - u<em>{2}ˏ</em>2 \mathrm{x<em>2}\left( t \right) \mathrm{y</em>2}\left( t \right) + l<em>{2}ˏ</em>2 u<em>{1}ˏ</em>2 \mathrm{x<em>1}\left( t \right) \mathrm{y</em>2}\left( t \right) + l<em>{2}ˏ</em>2 u<em>{2}ˏ</em>2 \mathrm{x<em>2}\left( t \right) \mathrm{y</em>2}\left( t \right) \end{align}</p><h3 id="Convert-to-ODEProblem"><a class="docs-heading-anchor" href="#Convert-to-ODEProblem">Convert to <code>ODEProblem</code></a><a id="Convert-to-ODEProblem-1"></a><a class="docs-heading-anchor-permalink" href="#Convert-to-ODEProblem" title="Permalink"></a></h3><p>Next we convert the <code>ODESystem</code> object to an <code>ODEProblem</code>. This is the object type that is used by the <code>DifferentialEquations</code> package and contains information on the simulation such as the starting biomass, simulation duration and the structure and parameters of the system. This is done by simply calling the <code>ODEProblem</code> constructor function on our <code>ODESystem</code> object. We also need to provide the inital state of our system which is provided as a vector of <code>Pair{Num,Float64}</code>s and a tuple for the simulation duration:</p><pre><code class="language-julia hljs">#define starting mass
u0 = fill(0.1, N+M)
u0 = [states(sys)[i] =&gt; u0[i] for i = eachindex(u0)]

tspan = (0.0, 10.0) #define tspan
#define ODEProblem (and include automatic calculation of the jacobian)
prob = ODEProblem(sys,u0,(0.0,100.0),[], jac = true)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ODEProblem with uType Vector{Float64} and tType Float64. In-place: true
timespan: (0.0, 100.0)
u0: 4-element Vector{Float64}:
 0.1
 0.1
 0.1
 0.1</code></pre><h3 id="Simulate-system"><a class="docs-heading-anchor" href="#Simulate-system">Simulate system</a><a id="Simulate-system-1"></a><a class="docs-heading-anchor-permalink" href="#Simulate-system" title="Permalink"></a></h3><p>Finally we simualte the system using the <code>solve</code> function from <code>DifferentialEquations</code>. This can be used directly or with additional arguments specifying the solver and callbacks to be used during the simulation. This function will return a solution object which contains the trajectories of the consumers.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../../">« Home</a><a class="docs-footer-nextpage" href="../examples/">Examples »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.12 on <span class="colophon-date" title="Friday 8 April 2022 10:30">Friday 8 April 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
